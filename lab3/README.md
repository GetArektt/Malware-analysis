# Analiza dynamiczna

As part of this laboratory, I will try the methods and tools to enable
performing basic dynamic analysis.

The enclosed instructions will make it possible to 
perform virus examination as soon as it has started. 

Due to the malicious nature of files used, for analysis
I will use a previously prepared "Sandbox" with Windows XP (SP3) - a separate environment

Unlike static analysis, dynamic analysis will enable realistic observation
of how malware is actually running. 

## Laboratorium 3.1

Przeprowadź analizę złośliwego oprogramowania znajdującego się w pliku Lab03-01.exe.

Wykorzystaj do tego celu podstawowe narzędzia do analizy dynamicznej. Odpowiedz na

poniższe pytania:


### 1. Jakie importy i łańcuchy jesteśmy w stanie odszukać w tym pliku?




Program `pestudio` wskazał odniesienie jedynie do jednego importu - `ExitProces` i biblioteki `kernel32.dll`. Jest to naprawdę mała liczba a tym samym podejrzane - najprawdopodobniej plik jest jakoś spakowany.




Również brak importów w stringsach


### 2. Podaj wszystkie indykatory hostowe związane z tym programem.

Niestety nie byłem w stanie uruchomić programu




Aczkolwiek udało mi się znaleźć coś podejrzanego




Program próbuje się z czymś połączyć po protokole `HTTP` w wersji 1


### 3. Czy wśród zebranych informacji znajdują się jakieś pomocne indykatory sieciowe mogące opisać analizowane złośliwe oprogramowanie?

Jedynie domena znaleziona w poprzednim podpunkcie


## Laboratorium 3.2

Przeprowadź analizę złośliwego oprogramowania znajdującego się w pliku Lab03-02.dll.

Wykorzystaj w tym celu podstawowe narzędzia do analizy dynamicznej. Odpowiedz na

poniższe pytania:


### 1. Wypisz najistotniejsze funkcje analizowanego pliku. Które z nich znajdują się na czarnej liście i dlaczego?




Funkcji jest naprawdę sporo - aż 85

Na czarnej liście znalazło się 31 funkcji m.in. funkcje odpowiedzialne za odczytywanie rejestru, obsługę systemu plików, połączenia (sockety), zamykanie systemu


### 2. W jaki sposób można zmusić program malware do instalacji?




Program posiada funkcje eksportującą `Install`

Można wymusić ją za pomocą narzędzia typu `rundll32`


### 3. W jaki sposób po zainstalowaniu złośliwego oprogramowania można go uruchomić?




za pomocą narzędzia `rundll32`


### 4. Jak można odszukać proces działający jako złośliwe oprogramowanie?

W programie `Process Explorer` brak śladów działania programu, mimo wielokrotnej próby jego uruchomienia





### 5. W celu zbierania informacji dotyczących złośliwego oprogramowania możemy wykorzystać program procmon. Jakich filtrów należy użyć, aby zebrać jak najwięcej istotnych informacji?




Prawdopodobniej najwięcej można odczytać filtrując po `Operation` z uwagi na możliwość wybrania danej funkcji

Przydatne również będzie wyświetlanie procesów tylko od jednego użytkownika




Oraz klasycznie po `PID`




lub po ścieżce





### 6. Odszukaj przydatne indykatory sieciowe dla analizowanego pliku.

Z uwagi na obecne funkcje zarządzania połączeniem sieciowym program ewidentnie próbuje się z czymś połączyć







Udało się znaleźć domenę `practicalmalwareanalysis.com`

oraz plik `serve.html`


## Laboratorium 3.3

Przeprowadź analizę złośliwego oprogramowania znajdującego się w pliku Lab03-03.exe.

Wykorzystaj do tego celu podstawowe narzędzia do analizy dynamicznej. Odpowiedz na

poniższe pytania:


### 1. Jakie informacje jesteś w stanie odszukać w trakcie analizy pliku Lab03-03.exe przy pomocy programu Process Explorer?




Program uruchamia się po czym po bardzo krótkiej chwili się wyłącza - najprawdopodobniej żeby uniknąć odkrycia

Udało mu się jednak uruchomić inne procesy - `svchost.exe`





### 2. Odszukaj zachodzące modyfikacje pamięci.

Program pierwotnie próbował coś odczytać







W procesie jego dziecka można zauważyć podejrzane napisy




Mogą one świadczyć o byciu `keyloggerem`


### 3. Wypisz indykatory hostowe należące do tego złośliwego programu.




Nie udało mi się znaleźć nic ciekawego


### 4. Opisz działanie tego programu.

Najpierw program uruchamia się po czym rozpoczyna kolejne procesy - po czym samoistnie się wyłącza - w celu ukrycia swojego działania. Następnie działa jak keylogger w trybie administratora, przechwytuje pewną grupę znaków.


## Laboratorium 3.4

Przeprowadź analizę złośliwego oprogramowania znajdującego się w pliku Lab03-04.exe.

Wykorzystaj do tego celu podstawowe narzędzia do analizy dynamicznej. Odpowiedz na

poniższe pytania:


### 1. Zbadaj strukturę PE oraz łańcuchy pliku Lab03-04.exe. Czy plik zawiera „ciekawe” informacje?




Program zawiera nawiązania sieciowe - próbuje pobrać plik `cmd.exe` z jakiegoś serwera. 

Są również zapytania HTTP




Importuje on sporo bibliotek i funkcji, z których duża część jest na blackliście




A część funkcji jest nawet nieznana lub zobsfukowana





### 2. Opisz zdarzenia towarzyszące uruchomieniu tego pliku.

Po uruchomieniu program usuwa się z folderu oraz procesów - w jego miejscu pojawia się konsola cmd. Poza tym nie zauważyłem żadnych podejrzanych zachowań


### 3. Co powoduje blokadę analizy dynamicznej?

Najprawdopodobniej program wykrywa obecność maszyny wirtualnej - a tym samym nie rozpoczyna swojego działania


### 4. W jaki sposób można uruchomić ten program

W debugerze bądź za pomocą metod analizy statystycznej

lub w sandboxie, który nie daje po sobie śladów

Również w serwisie `virustotal.com`

